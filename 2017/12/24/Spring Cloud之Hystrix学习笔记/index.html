<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Spring Cloud之Hystrix学习笔记 | CrazyIT</title>
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- 音频插件css begin-->
  <link rel="stylesheet" href="/css/audio/audioplayer.css">
  <!-- 音频插件css end-->
</head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/header.png)">
        <div class='av-pic' style="background-image: url(/assets/tree_small.png)">
        </div>
    </section>
    <section class='menu'>
        <div>CrazyIT</div>
        
            <div>Toss more than life</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/tags/" class="Btn">
              <li>Tags</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>Categories</li>
            </a>  
          
            <a href="/about/" class="Btn">
              <li>About</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a href="https://github.com/dicheng52119">
                    <img src="/assets/github.svg" />
                </a>
            
        
            
                <a href="https://www.facebook.com/profile.php?id=100023446571362">
                    <img src="/assets/facebook.svg" />
                </a>
            
        
            
                <a href="https://www.zhihu.com/people/yixie-zhi-qiu-16-96-61/activities">
                    <img src="/assets/zhihu.svg" />
                </a>
            
        
            
                <a href="https://www.csdn.net/">
                    <img src="/assets/csdn.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>Spring Cloud之Hystrix学习笔记</h1>
    </header>

    <section>
      <h3 id="Hystrix介绍"><a href="#Hystrix介绍" class="headerlink" title="Hystrix介绍"></a>Hystrix介绍</h3><p>Spring Cloud Hystrix实现了断路器、线程隔离等一系列服务保护功能。它是基于Netflix的开源框架Hystrix实现的，该框架的目标在于通过控制那些访问远程系统、服务和第三方库的节点，从而对延迟和故障提供更强大的容错能力。Hystrix具备服务降级、服务熔断、线程和信号隔离、请求缓存、请求合并以及服务监控等强大功能。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul>
<li>需要启动的工程：<ol>
<li>eureka-server工程：服务注册中心。</li>
<li>hello-service工程：HELLO-SERVICE的服务单元，启动两个不同端口的服务实例。</li>
<li>ribbon-consume工程：使用Ribbon实现的服务消费者。</li>
</ol>
</li>
</ul>
<h3 id="引入Spring-Cloud-Hystrix"><a href="#引入Spring-Cloud-Hystrix" class="headerlink" title="引入Spring Cloud Hystrix"></a>引入Spring Cloud Hystrix</h3><ul>
<li><p>在ribbon-consumer工程的pom.xml的dependency节点中引入spring-cloud-starter-hystrix依赖</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</span><br><span class="line">dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在ribbon-consumer工程的主类中使用@EnableCircuitBreaker注解开启断路器功能</p>
</li>
</ul>
<a id="more"></a>
  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.EnableCircuitBreaker 熔断器配置注解</span></span><br><span class="line"><span class="comment">//2.EnableDiscoveryClient 服务注册与发现注解</span></span><br><span class="line"><span class="comment">//3.SpringBootApplication springboot启动类注解</span></span><br><span class="line"><span class="comment">//4.SpringCloudApplication 包含上面3个注解</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RibbonConsumerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@LoadBalanced</span></span><br><span class="line">  <span class="function">RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	  <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	  SpringApplication.run(RibbonConsumerApplication.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>添加HelloService类，注入RestTemplate实例，在需要断路处理的方法上添加@HystrixCommand注解来指定回调方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"helloFallback"</span>, commandKey = <span class="string">"helloKey"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">helloConsumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加HystrixCommand注解来制定回调方法</span></span><br><span class="line">    String result = restTemplate.getForEntity(<span class="string">"http://HELLO-SERVICE/hello"</span>, String.class).getBody();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">"Spend time:"</span>+(end - start));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">helloFallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>停止其中一个端口的Hello-Service，确保其他工程均已启动，访问<a href="http://localhost:9001/ribbon-consumer" target="_blank" rel="noopener">http://localhost:9001/ribbon-consumer</a> ，当轮询访问到停止的端口的服务时，输出内容为error，而不再是错误内容。</p>
</li>
</ul>
<h3 id="Hystrix-仪表盘介绍"><a href="#Hystrix-仪表盘介绍" class="headerlink" title="Hystrix 仪表盘介绍"></a>Hystrix 仪表盘介绍</h3><p>主要用来实时监控Hystrix 的各项指标信息。通过Hystrix Dasboard反馈的实时信息，可以帮助我们快速发现系统中存在的问题，从而及时的采取应对措施。</p>
<h3 id="Hystrix-Dashboard的架构介绍"><a href="#Hystrix-Dashboard的架构介绍" class="headerlink" title="Hystrix Dashboard的架构介绍"></a>Hystrix Dashboard的架构介绍</h3><p>本节中我们将在Hystrix入门例子的基础上，构建一个Hystrix Dashboard来对RIBBON-CONSUMER实时监控，完成后的架构如下图所示：<br><img src="https://github.com/dicheng52119/dicheng52119.github.io/blob/master/images/spring-cloud/Hystrix%20Dashboard%E6%9E%B6%E6%9E%84%E5%9B%BE.png?raw=true" alt=""></p>
<h3 id="Hystrix-Dashboard的快速构建"><a href="#Hystrix-Dashboard的快速构建" class="headerlink" title="Hystrix Dashboard的快速构建"></a>Hystrix Dashboard的快速构建</h3><ul>
<li>创建一个标准的Spring Boot工程，命名为hystrix-dashboard。</li>
<li><p>编辑pom.xml，具体依赖内容如下所以：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">		&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-cloud-starter-hystrix-dashboard&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">	&lt;!--</span><br><span class="line">		旧版本的</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;1.3.5.RELEASE&lt;/version&gt;</span><br><span class="line">		对应旧版本的</span><br><span class="line">		&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;Brixton.RELEASE&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">		新版本的</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;1.5.3.RELEASE&lt;/version&gt;</span><br><span class="line">		对应新版本的</span><br><span class="line">		&lt;spring-cloud.version&gt;Dalston.SR1&lt;/spring-cloud.version&gt;</span><br><span class="line"></span><br><span class="line">		otherwise ， 报错。。。</span><br><span class="line">	--&gt;</span><br><span class="line">	&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">			&lt;version&gt;Dalston.SR1&lt;/version&gt;</span><br><span class="line">			&lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">			&lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">	&lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>为应用主类加上@EnableHystrixDashboard，启用Hystrix Dashboard功能。</p>
</li>
<li><p>根据实际情况修改application.properties配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">spring.application.name=hystrix-dashboard</span><br><span class="line">server.port=2001</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动该应用，访问<a href="http://localhost:2001/hystrix" target="_blank" rel="noopener">http://localhost:2001/hystrix</a> 。</p>
</li>
</ul>
<h3 id="Hystrix-Dashboard页面介绍"><a href="#Hystrix-Dashboard页面介绍" class="headerlink" title="Hystrix Dashboard页面介绍"></a>Hystrix Dashboard页面介绍</h3><ul>
<li><p>监控首页</p>
<p><img src="https://github.com/dicheng52119/dicheng52119.github.io/blob/master/images/spring-cloud/hystrix%E7%9B%91%E6%8E%A7%E9%A6%96%E9%A1%B5.png?raw=true" alt=""></p>
<ul>
<li>Hystrix Dashboard 共支持三种不同的监控方式：</li>
</ul>
<ol>
<li><p>默认的集群监控：通过URL <a href="http://turbine-host:port/turbine.stream" target="_blank" rel="noopener">http://turbine-host:port/turbine.stream</a> 开启，实现对默认集群的监控。</p>
</li>
<li><p>指定的集群监控：通过URL <a href="http://turbine-host:port/turbine.stream.stream?cluster=[clusterName]开启，实现对clusterName集群的监控。" target="_blank" rel="noopener">http://turbine-host:port/turbine.stream.stream?cluster=[clusterName]开启，实现对clusterName集群的监控。</a></p>
</li>
<li><p>单体应用的监控：通过URL <a href="http://hystrix-app:port/hystrix.stream" target="_blank" rel="noopener">http://hystrix-app:port/hystrix.stream</a> 开启，实现对具体某个服务实例的监控。  </p>
</li>
</ol>
<ul>
<li><p>Delay：该参数用来控制服务器上轮询监控信息的延迟时间，默认为2000ms，可以通过配置该属性来降低客户端的网络和CPU消耗。</p>
</li>
<li><p>Title：该参数对应了监控图头部标题Hystrix Stream之后的内容，默认会使用具体监控实例的URL，可以通过配置该信息来展示更合适的标题。</p>
</li>
</ul>
</li>
<li><p>监控页面</p>
<ul>
<li>可以在监控信息的左上部找到两个重要的图形信息：一个实心圆和一条曲线。</li>
</ul>
<ol>
<li><p>实心圆：通过颜色的变化代表了实例的健康程度，它的健康度从绿色、黄色、橙色、红色递减。它的大小会根据实例的请求流量发生变化，流量越大该实心圆就越大。通过该实心圆，可以在大量的实例中快速发现故障实例和高压力实例。</p>
</li>
<li><p>曲线：用来记录2分钟内流量的相对变化，可以通过它来观察流量的上升和下降趋势。</p>
</li>
</ol>
<ul>
<li><p>其他一些数量指标如下图所示：</p>
<p><img src="https://github.com/dicheng52119/dicheng52119.github.io/blob/master/images/spring-cloud/hystrix%E5%BA%A6%E9%87%8F%E6%8C%87%E6%A0%87%E8%AF%B4%E6%98%8E.png?raw=true" alt=""></p>
</li>
</ul>
</li>
</ul>
<h3 id="Turbine集群监控介绍"><a href="#Turbine集群监控介绍" class="headerlink" title="Turbine集群监控介绍"></a>Turbine集群监控介绍</h3><p>Hystrix Dashboard通过监控端点/turbine.stream对集群进行监控。通过引入Turbine，来汇集集群服务的监控信息，并将聚合后的信息供给Hystrix Dashboard来集中展示和监控。</p>
<h3 id="监控聚合服务架构图"><a href="#监控聚合服务架构图" class="headerlink" title="监控聚合服务架构图"></a>监控聚合服务架构图</h3><p><img src="https://github.com/dicheng52119/dicheng52119.github.io/blob/master/images/spring-cloud/turbine%E8%81%9A%E5%90%88%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.png?raw=true" alt=""></p>
<h3 id="turbine工程的快速构建"><a href="#turbine工程的快速构建" class="headerlink" title="turbine工程的快速构建"></a>turbine工程的快速构建</h3><ul>
<li>创建一个标准的Spring Boot工程，命名为turbine。</li>
<li><p>编辑pom.xml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">		&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-cloud-starter-turbine&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>  <dependencymanagement></dependencymanagement></p>
<pre><code>&lt;!--
    旧版本的
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
    对应旧版本的
    &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
    &lt;version&gt;Brixton.RELEASE&lt;/version&gt;

    新版本的
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.5.3.RELEASE&lt;/version&gt;
    对应新版本的
    &lt;spring-cloud.version&gt;Dalston.SR1&lt;/spring-cloud.version&gt;

    otherwise ， 报错。。。
--&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
        &lt;version&gt;Dalston.SR1&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre><p>  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">	</span><br><span class="line">* 应用主类使用@EnableTurbine注解开启Turbine</span><br><span class="line">  ``` java</span><br><span class="line">  @EnableTurbine</span><br><span class="line">  @EnableDiscoveryClient</span><br><span class="line">  @SpringBootApplication</span><br><span class="line">  public class TurbineApplication &#123;</span><br><span class="line"></span><br><span class="line">		public static void main(String[] args) &#123;</span><br><span class="line">			SpringApplication.run(TurbineApplication.class, args);</span><br><span class="line">		&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在application.properties中加入Eureka和Turbine的相关配置</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">spring.application.name=turbine</span><br><span class="line"></span><br><span class="line">server.port=8989</span><br><span class="line">management.port=8990</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://peer1:1111/eureka/</span><br><span class="line"></span><br><span class="line"># 指定了需要收集监控信息的服务名</span><br><span class="line">turbine.app-config=RIBBON-CONSUMER</span><br><span class="line"></span><br><span class="line"># 指定了集群名称，当服务非常多的时候，启动多个Turbine服务来构建不同的聚合集群，而该参数可以用来区分这些不同的聚合集群，</span><br><span class="line"># 只需在Hystrix Stream的url中通过cluster参数来指定 </span><br><span class="line">turbine.cluster-name-expression=&quot;default&quot;</span><br><span class="line"></span><br><span class="line"># 可以让同一主机上的服务通过主机名和端口号的组合来进行区分</span><br><span class="line">turbine.combine-host-port=true</span><br></pre></td></tr></table></figure>
</li>
<li><p>体验一下Turbine对集群的监控能力。分别启动eureka-server、HELLO-SERVICE、RIBBON-CONSUMER、Turbine以及Hystrix Dashboard。访问Hystrix Dashboard，并开启对<a href="http://localhost:8989/turbine.stream" target="_blank" rel="noopener">http://localhost:8989/turbine.stream</a> 的监控。</p>
</li>
</ul>
<h3 id="与消息代理结合简介"><a href="#与消息代理结合简介" class="headerlink" title="与消息代理结合简介"></a>与消息代理结合简介</h3><p>Spring Cloud在封装Turbine的时候，还封装了基于消息代理的收集实现。所以，我们可以将所有需要收集的监控信息都输出到消息代理中，然后Turbine服务再从消息代理中异步获取这些监控信息，最后将这些监控信息聚合并输出到Hystrix Dashboard中。</p>
<h3 id="Turbine与消息代理整合架构图"><a href="#Turbine与消息代理整合架构图" class="headerlink" title="Turbine与消息代理整合架构图"></a>Turbine与消息代理整合架构图</h3><p><img src="https://github.com/dicheng52119/dicheng52119.github.io/blob/master/images/spring-cloud/Turbine%E4%B8%8E%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86%E7%BB%93%E5%90%88%E6%9E%B6%E6%9E%84%E5%9B%BE.png?raw=true" alt=""></p>
<h3 id="创建基于消息代理的Turbine聚合服务"><a href="#创建基于消息代理的Turbine聚合服务" class="headerlink" title="创建基于消息代理的Turbine聚合服务"></a>创建基于消息代理的Turbine聚合服务</h3><ul>
<li>创建一个标准的Spring Boot工程，命名为turbine-amqp。</li>
<li><p>编辑pom.xml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">		&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-cloud-starter-turbine-amqp&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>  <dependencymanagement></dependencymanagement></p>
<pre><code>&lt;!--
    旧版本的
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.3.5.RELEASE&lt;/version&gt;
    对应旧版本的
    &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
    &lt;version&gt;Brixton.RELEASE&lt;/version&gt;

    新版本的
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;1.5.3.RELEASE&lt;/version&gt;
    对应新版本的
    &lt;spring-cloud.version&gt;Dalston.SR1&lt;/spring-cloud.version&gt;

    otherwise ， 报错。。。
--&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
        &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
        &lt;version&gt;Dalston.SR1&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre><p>  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">* 在应用主类中使用@EnableTurbineStream注解来启用Turbine Stream的配置。</span><br><span class="line">  ``` java</span><br><span class="line">  @EnableTurbineStream</span><br><span class="line">  @EnableDiscoveryClient</span><br><span class="line">  @SpringBootApplication</span><br><span class="line">  public class TurbineAmqpApplication &#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		SpringApplication.run(TurbineAmqpApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置application.properties文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">spring.application.name=turbine</span><br><span class="line"></span><br><span class="line">server.port=8989</span><br><span class="line">management.port=8990</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://peer1:1111/eureka/</span><br></pre></td></tr></table></figure>
</li>
<li><p>对服务消费者RIBBON-CONSUMER做一些修改，使其监控信息能够输出到RabbitMQ上。修改其pom文件，添加依赖。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-cloud-netflix-hystrix-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>完成配置之后，继续启动eureka-server、HELLO-SERVICE、RIBBON-CONSUMER、Turbine以及Hystrix Dashboard，同时确保RabbitMQ已在正常运行，访问Hystrix Dashboard，并开启对<a href="http://localhost:8989/turbine.stream" target="_blank" rel="noopener">http://localhost:8989/turbine.stream</a> 的监控，效果和之前一样，只是这里的监控信息收集是通过消息代理异步实现的。</p>
</li>
</ul>
<p><br></p>
<h3 id="nbsp-nbsp-nbsp-版权声明：本文为博主原创文章，转载请标明作者和原链接"><a href="#nbsp-nbsp-nbsp-版权声明：本文为博主原创文章，转载请标明作者和原链接" class="headerlink" title="| &nbsp;&nbsp;&nbsp;版权声明：本文为博主原创文章，转载请标明作者和原链接"></a><font color="red"><b>| &nbsp;&nbsp;&nbsp;版权声明：本文为博主原创文章，转载请标明作者和原链接<br></b></font></h3>

      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2017-12-24T04:15:05.000Z" itemprop="datePublished">
              2017-12-24
            </time>
          </div>
          
            <div>
              tags: 
  <li class="meta-text">
  { <a href="/tags/technology/">technology</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/springboot/">springboot</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/spring-cloud/">spring cloud</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/hystrix/">hystrix</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/turbine/">turbine</a> }
  </li>


            </div>
          
      </section>
    
    
</article>

  
</div>

            <footer>
    <div>© 2015 - Mr.CrazyDC </div>
    <div>
    Powered by Hexo
    </div>
</footer>

        </div>
        
        <!-- 底部音频插件 begin -->
        <div id="wrapper" style="width:40%;padding-bottom:10px;padding-left:830px;">
            <audio preload="auto" controls>
                <source src="/mp3/说散就散.mp3">
            </audio>
            <script src="js/pager/audio/jquery.js"></script>
            <script src="js/pager/audio/audioplayer.js"></script>
            <script>$( function() { $( 'audio' ).audioPlayer(); } );</script>
        </div>
        <!-- 底部音频插件 end -->
    </div>
</div>
<script src="/js/pager/dist/singlepager.js"></script>
<!-- 网页动态背景——随鼠标变换的动态线条 begin-->
<script src="/js/pager/canvas-nest/canvas-nest.js"></script>
<!-- 网页动态背景——随鼠标变换的动态线条 end-->
<script>
var sp = new Pager('data-pager-shell')
</script>
</body>
</html>